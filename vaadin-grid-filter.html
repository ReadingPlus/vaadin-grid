
<!--
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<!--

`vaadin-grid-filter` is a helper element for the `vaadin-grid` that provides out-of-the-box UI controls,
and handlers for filtering the grid data.

-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">

<dom-module id="vaadin-grid-filter">
  <template>
    <style>
      :host {
        position: relative;
        display: inline-flex;
        flex-direction: row;
        align-items: center;
      }

      #filter {
        width: 100%;
        box-sizing: border-box;
      }

      [icon] {
        position: absolute;
        right: 0;
        /* top: 0; */
        /* bottom: 0; */
        color: #555555;
        height: 36px;
        width: 36px;
      }

      .container {
        position: relative;
        display: flex;
        flex-direction: row;
        align-items: center;
      }
    </style>

    <div class=container>
      <slot name="filter">
        <input id="filter" value="{{value::input}}">
      </slot>

      <template is="dom-if" if="[[_showClear]]">
        <paper-icon-button on-tap="clear" icon="cancel"></paper-icon-button>
      </template>
    </div>


  </template>
  <script>
    Polymer({
      is: 'vaadin-grid-filter',

      properties: {

        /**
         * JS Path of the property in the item used for filtering the data.
         */
        path: String,

        /**
         * Current filter value.
         */
        value: {
          type: String,
          notify: true
        }
      },

      observers: ['_filterChanged(path, value, isAttached)'],

      ready: function() {
        var child = Polymer.dom(this).firstElementChild;
        if (child && child.getAttribute('slot') !== 'filter') {
          console.warn('Make sure you have assigned slot="filter" to the child elements of <vaadin-grid-filter>');
          child.setAttribute('slot', 'filter');
        }

        this._updateShowClear();
      },

      _filterChanged: function(path, value, isAttached) {
        if (path === undefined || value === undefined || isAttached === undefined) {
          return;
        }

        this._updateShowClear();

        if (isAttached) {
          this.debounce('filter-changed', function() {
            this.fire('filter-changed');
          }, 200);
        }
      },

      clear: function() {
        this.value = '';
      },

      _updateShowClear: function() {
        this._showClear = !this.queryEffectiveChildren('[slot=filter]').querySelector('select');
      }
    });
  </script>
</dom-module>
